function doGet() {
  var url = 'https://mpc1.mediacp.eu:2000/json/stream/kiara-radio';
  var response = UrlFetchApp.fetch(url);
  var data = JSON.parse(response.getContentText());
  
  var nowplaying = data.nowplaying || 'Kiara Radio - Streaming';
  var parts = nowplaying.split(' - ');
  var artist = parts[0] ? parts[0].trim() : 'Kiara Radio';
  var title = parts[1] ? parts[1].trim() : 'Streaming';
  
  var output = {
    icestats: {
      source: {
        artist: artist,
        title: title,
        listeners: data.connections || 0,
        bitrate: data.bitrate || '128'
      }
    }
  };
  
  return ContentService.createTextOutput(JSON.stringify(output))
    .setMimeType(ContentService.MimeType.JSON)
    .setHeaders({
      'Access-Control-Allow-Origin': '*'
    });
}
